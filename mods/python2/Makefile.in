-include ../../Makefile.settings
PYTHON = @PYTHON@
PYTHON_PREFIX = @PYTHON_PREFIX@
SWIG = @SWIG@
PYCFLAGS = @PY_CFLAGS@
PYLDFLAGS = @PY_LIBS@
CFLAGS += -I../.. -I..
LDFLAGS += 

all: build libpython2.so

lib%.so: %.c
	$(CC) $(LDFLAGS) $(PYLDFLAGS) -shared -o $@ $<

%.o: %.c
	$(CC) $(CFLAGS) $(PYCFLAGS) -Dinit_plugin=$*_init -Dfini_plugin=$*_fini -Dname_plugin=$*_name -Dload_config=$*_load_config -Dsave_config=$*_save_config -c $<

build: ctrlproxy_wrap.c admin_wrap.c listener_wrap.c
	LDFLAGS="$(LDFLAGS)" CFLAGS="$(CFLAGS)" $(PYTHON) setup.py build

install: all
	$(PYTHON) setup.py install
	$(INSTALL) libpython2.so $(DESTDIR)$(modulesdir)

clean:
	rm -f *_wrap.c *.pyc
	rm -f ctrlproxy.py
	$(PYTHON) setup.py clean
	rm -rf build/

%_wrap.c: ../swig/%.i
	$(SWIG) -I../swig -python $*.i
