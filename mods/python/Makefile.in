CC = @CC@
prefix = @prefix@
exec_prefix = @exec_prefix@
moddir = @libdir@/ctrlproxy
INSTALL = @INSTALL@
CFLAGS = @PY_CFLAGS@ -Wall -fno-strict-aliasing -fPIC -I../.. -I.. @CFLAGS@ @PKG_CFLAGS@  -DSHAREDIR=\"@datadir@\"
LIBS = @PY_LIBS@
PYLIBDIR = \"@libdir@/ctrlproxy/python\"
DPREFIX = \"${prefix}\"
DSHAREDIR = \"@datadir@\"

.PHONY: all clean distclean install

all: libpython.so

install:
	$(INSTALL) -d $(DESTDIR)$(moddir)/python
	$(INSTALL) libpython.so $(DESTDIR)$(moddir)
	$(INSTALL) ctrlproxy_tools.py $(DESTDIR)$(moddir)/python/ctrlproxy_tools.py
	$(INSTALL) __init__.py $(DESTDIR)$(moddir)/python/__init__.py

%.o: %.c
	$(CC) $(CFLAGS) -Dinit_plugin=$*_init -Dfini_plugin=$*_fini -Dname_plugin=$*_name -Dload_config=$*_load_config -Dsave_config=$*_save_config -DPYLIBDIR=$(PYLIBDIR) -DPREFIX=$(DPREFIX) -DSHAREDIR=$(DSHAREDIR) -fPIC -c $<

libpython.so: python.o types.o
	$(CC) -shared -o $@ $^ $(LIBS)

clean:
	rm -f libpython.so *.o

distclean: clean
	rm -f Makefile
