CC = @CC@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
INSTALL = @INSTALL@
CFLAGS = -fPIC -I../.. -I.. @CFLAGS@ @PKG_CFLAGS@ -DSHAREDIR=\"@datadir@\"

moddir = @libdir@/ctrlproxy

.PHONY: all install clean distclean

all: libstats.so printstats libstatsutil.so cisg

install: all
	$(INSTALL) libstats.so $(DESTDIR)$(moddir)
	$(INSTALL) printstats $(DESTDIR)$(bindir)

%.o: %.c
	$(CC) $(CFLAGS) -fPIC -c $<

libstatsutil.so: statsutil.o
	$(CC) $(CFLAGS) -shared -o $@ $< -ltdb

libstats.so: stats.o
	$(CC) $(CFLAGS) -shared -o $@ $< -ltdb @LIB_PCRE@

printstats: printstats.o
	$(CC) -o $@ -ltdb $<

cisg: cisg.o statsutil.o
	$(CC) -o $@ $< statsutil.o -ltdb

clean:
	rm -f $(MODS) *.o

distclean: clean
	rm -f Makefile
